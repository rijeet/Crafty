@using Crafty.Models

@model IEnumerable<Crafty.Models.Order_tbl>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPageAdmin.cshtml";
}


@section styles {
    <link href="~/plugins/jvectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet">
    <link href="~/plugins/lightpick/lightpick.css" rel="stylesheet" />
}

<!-- Page-Title -->
<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <div class="float-right">
            </div>
            <h4 class="page-title">Dashboard</h4>
        </div><!--end page-title-box-->
    </div><!--end col-->
</div>
<!-- end page title end breadcrumb -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <h4 class="header-title mt-0">Revenue</h4>
                <div class="row">
                    <div class="col-md-4">
                        <div class="media my-3">
                            <img src="~/images/widgets/dollar.png" alt="" class="thumb-md rounded-circle">
                            <div class="media-body align-self-center text-truncate ml-3">

                                @{



                                    Crafty_DBEntities1 db = new Crafty_DBEntities1();
                                    //  var user = db.User_tbl.Where(x => x.Username == userid).FirstOrDefault();
                                    //  var username = user.Username;
                                    var obj = db.User_tbl.ToList();

	                                var Revenue = 0;

                                   



                                }

                                @foreach (var item in Model)
                                {


                                    var product = db.Product_tbl.Where(x => x.P_ID == item.P_ID).FirstOrDefault();


                                    Revenue +=Convert.ToInt32(product.Product_Offer_Price) - Convert.ToInt32(product.Product_Base_Price);



                                }
                            
                                @{

	                                <h4 class="mt-0 mb-1 font-weight-semibold text-dark font-24">$ @Url.Content(Convert.ToString(Revenue))</h4>

                                   



                                }
                                <p class="text-muted text-uppercase mb-0 font-12">Total Revenue Of This Month</p>
                            </div><!--end media-body-->
                        </div>
                    </div><!--end col-->
                    <div class="col-md-8">
                        <ul class="nav-border nav nav-pills" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link font-weight-semibold" data-toggle="tab" href="#Today" role="tab">Today</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link font-weight-semibold" data-toggle="tab" href="#This_Week" role="tab">This Week</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active font-weight-semibold" data-toggle="tab" href="#This_Month" role="tab">This Month</a>
                            </li>
                        </ul>
                    </div><!--end col-->
                </div> <!--end row-->
                <div class="tab-content">
                    <div class="tab-pane pt-3" id="Today" role="tabpanel">
                        <div id="eco_dash" class="apex-charts"></div>
                    </div><!-- Tab panes -->
                    <div class="tab-pane pt-3" id="This_Week" role="tabpanel">
                        <div id="Top_Week" class="apex-charts"></div>
                    </div><!-- Tab panes -->
                    <div class="tab-pane active pt-3" id="This_Month" role="tabpanel">
                        <canvas id="bar" class="drop-shadow w-100" height="350"></canvas>
                    </div><!-- Tab panes -->
                </div><!-- Tab content -->
            </div><!--end card-body-->
        </div><!--end card-->
    </div><!--end col-->

    <div class="col-lg-4">
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4 align-self-center text-center">
                                <i data-feather="users" class="align-self-center icon-lg icon-dual-pink"></i>
                            </div><!--end col-->
                            <div class="col-8">
                                <h3 class="mt-0 mb-1 font-weight-semibold">24k</h3>
                                <p class="mb-0 font-12 text-muted text-uppercase font-weight-semibold-alt">Visits</p>
                            </div><!--end col-->
                        </div> <!--end row-->
                    </div><!--end card-body-->
                </div><!--end  card-->
            </div> <!--end col-->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body justify-content-center">
                        <div class="row">
                            <div class="col-4 align-self-center text-center">
                                <i data-feather="shopping-cart" class="align-self-center icon-lg icon-dual-secondary"></i>
                            </div><!--end col-->
	                        <div class="col-8">
                                
		                        @{



		                        <h3 class="mt-0 mb-1 font-weight-semibold">10k</h3>
		                        
		                        
		                        }
		                       
		                        <p class="mb-0 font-12 text-muted text-uppercase font-weight-semibold-alt">New Orders</p>
	                        </div><!--end col-->
                        </div> <!--end row-->
                    </div><!--end card-body-->
                </div><!--end  card-->
            </div> <!--end col-->
        </div><!--end row-->
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4 align-self-center text-center">
                                <i data-feather="repeat" class="align-self-center icon-lg icon-dual-purple"></i>
                            </div><!--end col-->
                            <div class="col-8">
                                <h3 class="mt-0 mb-1 font-weight-semibold">1.5k</h3>
                                <p class="mb-0 font-12 text-uppercase font-weight-semibold-alt text-muted">Return Orders</p>
                            </div><!--end col-->
                        </div> <!--end row-->
                    </div><!--end card-body-->
                </div><!--end  card-->
            </div> <!--end col-->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body justify-content-center">
                        <div class="row">
                            <div class="col-4 align-self-center text-center">
                                <i data-feather="layers" class="align-self-center icon-lg icon-dual-warning"></i>
                            </div><!--end col-->
                            <div class="col-8">
                                <h3 class="mt-0 mb-1 font-weight-semibold">+22.98%</h3>
                                <p class="mb-0 font-12 text-uppercase font-weight-semibold-alt text-muted">Growth</p>
                            </div><!--end col-->
                        </div> <!--end row-->
                    </div><!--end card-body-->
                </div><!--end  card-->
            </div> <!--end col-->
        </div><!--end row-->
        <div class="card">
            <div class="card-body">
                <h4 class="header-title mb-3">Monthly Trends</h4>
                <div class="row">
                    <div class="col-6">
                        <div id="eco_categories" class="apex-charts mb-n3"></div>
                    </div><!--end col-->
                    <div class="col-6 align-self-center">
                        <ul class="list-unstyled">
                            <li class="list-item mb-2 font-weight-semibold-alt">
                                <i class="fas fa-play text-primary mr-2"></i>Electronic
                            </li>
                            <li class="list-item mb-2 font-weight-semibold-alt">
                                <i class="fas fa-play text-success mr-2"></i>Footwear
                            </li>
                            <li class="list-item font-weight-semibold-alt">
                                <i class="fas fa-play text-pink mr-2"></i>Clothes
                            </li>
                        </ul>
                        <button type="button" class="btn btn-sm btn-outline-primary btn-round dual-btn-icon">View Details <i class="mdi mdi-arrow-right"></i></button>
                    </div><!--end col-->
                </div> <!--end row-->
            </div><!--end card-body-->
        </div><!--end  card-->
    </div><!--end col-->
</div><!--end row-->
<h6 class="mt-0 header-title mb-0">Top 3 Best Buyers</h6>
<div class="row">
   

    @{



        var query =

            (from item in db.Order_tbl

             group item.Total by item.U_ID into g

             orderby g.Sum() descending

             select g.Key).Take(3).ToList();

	    

    }

    @foreach (var item in query)
    {
        var user = db.User_tbl.Where(x => x.U_ID == item.Value).FirstOrDefault();
        string amoun = null;

        foreach (var iteem in Model)
        {


            var amount = db.Order_tbl.Where(x => x.U_ID == item.Value).Sum(x=>x.Total);


            //amoun += Convert.ToInt32(amount.Total);

	        amoun = Convert.ToString(amount);

        }


        <div class="col-lg-4">
            <div class="card">
                <div class="card-body dash-info-carousel">
                   
                    <div id="carousel_1" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            
                            <div class="carousel-item active">
                                <div class="media mb-2 mt-3">
                                    <div class="user-img-box">
	                                    <img src="@Url.Content(user.Image)" alt="" height="128" class="rounded-circle">
                                        <img src="~/images/flags/us_flag.jpg" alt="" class="flag">
                                    </div>
                                    <div class="media-body align-self-center text-truncate ml-3">
                                         <h4 class="mt-0 font-weight-semibold text-dark font-24">@Url.Content(user.Username)</h4>
                                        <p class="text-muted text-uppercase mb-0 font-12">Total Buy</p>
                                        <h4 class="font-18 text-success font-weight-semibold">$@Url.Content(Convert.ToString(amoun))</h4>
                                    </div><!--end media-body-->
                                </div><!--end media-->
                            </div><!--end carousel-item-->
                            
                        </div><!--end carousel-inner-->
                        <a class="carousel-control-prev" href="#carousel_1" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carousel_1" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div><!--end carousel-->
                </div><!--end card-body-->
            </div><!--end card-->
        </div><!--end col-->


    }





</div>


<div class="row">

    <div class="col-lg-4">
        <div class="card">
            <div class="card-body">
                <h4 class="mt-0 header-title mb-3">Populer Product</h4>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">



                        @{



                            var queryp =

                                (from item in db.Order_tbl

                                 group item.Total by item.P_ID into g

                                 orderby g.Sum() descending

                                 select g.Key).Take(3).ToList();



                        }

                        @foreach (var itm in queryp)
                        {
                            var user = db.Product_tbl.Where(x => x.P_ID == itm.Value).FirstOrDefault();
                            string amoun = null;

                            foreach (var iteeem in Model)
                            {


                                var amount = db.Order_tbl.Where(x => x.P_ID == itm.Value).Sum(x => x.Total);


                                //amoun += Convert.ToInt32(amount.Total);

                                amoun = Convert.ToString(amount);

                            }

                            <tbody>
                                <tr>
                                    <td class="border-top-0">
                                        <div class="media">
                                            <img src="@Url.Content(user.Product_Image)" height="80" class="mr-4" alt="...">
                                            <div class="media-body align-self-center">
                                                <span class="badge badge-soft-warning p-2 font-12 mb-2">@Url.Content(Convert.ToString(user.Product_Sold)) sold</span>
                                                <h4 class="mt-0 title-text mb-0">@Url.Content(user.Product_Name)</h4>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right border-top-0">
                                        <h5 class="">$@Url.Content(user.Product_Base_Price)</h5>
                                    </td>
                                </tr><!--/tr-->
                            </tbody>



                        }









                    </table>
                </div>
            </div><!--end card-body-->
        </div><!--end card-->
    </div><!--end col-->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <h4 class="header-title mt-0 mb-4">Top Sales In USA</h4>
                <div class="row">
                    <div class="col-lg-7">
                        <div id="usa" class="drop-shadow-map" style="height: 305px"></div>
                    </div><!--end col-->
                    <div class="col-lg-5 align-self-center">
                        <div class="">
                            <span class="text-dark">Texas</span>
                            <small class="float-right text-muted ml-3 font-13">81%</small>
                            <div class="progress mt-2" style="height:3px;">
                                <div class="progress-bar bg-pink" role="progressbar" style="width: 81%; border-radius:5px;" aria-valuenow="81" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <span class="text-dark">Washington</span>
                            <small class="float-right text-muted ml-3 font-13">68%</small>
                            <div class="progress mt-2" style="height:3px;">
                                <div class="progress-bar bg-secondary" role="progressbar" style="width: 68%; border-radius:5px;" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-dark">Wyoming</span>
                            <small class="float-right text-muted ml-3 font-13">48%</small>
                            <div class="progress mt-2" style="height:3px;">
                                <div class="progress-bar bg-purple" role="progressbar" style="width: 48%; border-radius:5px;" aria-valuenow="48" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <span class="text-dark">Virginia</span>
                            <small class="float-right text-muted ml-3 font-13">32%</small>
                            <div class="progress mt-2" style="height:3px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 32%; border-radius:5px;" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div><!--end col-->
                </div><!--end row-->
            </div><!--end card-body-->
        </div><!--end card-->
    </div><!--end col-->
    
</div>   
    
	<div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body order-list">
                    <h4 class="header-title mt-0 mb-3">Order List</h4>
                    <div class="table-responsive">


                        <table class="table table-hover mb-0">
                            <thead class="thead-light">
                                <tr>
                                    <th class="border-top-0">Product</th>
                                    <th class="border-top-0">Product Name</th>
                                    <th class="border-top-0">Order Date/Time</th>
                                    <th class="border-top-0">Customer Name</th>
                                    <th class="border-top-0">Amount ($)</th>
                                    <th class="border-top-0">Status</th>
                                </tr><!--end tr-->
                            </thead>

                            @foreach (var it in Model)
                            {

                                <tbody>
                                    <tr>
                                        <td>
                                            <img class="" src="@Url.Content(it.Product_tbl.Product_Image)" height="80">

                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => it.Product_tbl.Product_Name)
                                        </td>

                                        <td>@Html.DisplayFor(modelItem => it.Order_Date)</td>
                                        <td> @Html.DisplayFor(modelItem => it.User_tbl.Username)</td>
                                        <td>@Html.DisplayFor(modelItem => it.Total) </td>
                                        <td>
                                            <span class="badge badge-md badge-boxed  badge-soft-success">@Html.DisplayFor(modelItem => it.Order_Status)</span>
                                        </td>
                                    </tr><!--end tr-->
                                </tbody>

                            }
                        </table> <!--end table-->
                    </div><!--end /div-->
                </div><!--end card-body-->
            </div><!--end card-->
        </div><!--end col-->
    </div><!--end row-->

@section scripts {
    <script src="~/plugins/chartjs/chart.min.js"></script>
    <script src="~/plugins/chartjs/roundedBar.min.js"></script>
    <script src="~/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="~/plugins/jvectormap/jquery-jvectormap-us-aea-en.js"></script>
    <script src="~/scripts/pages/jquery.ecommerce_dashboard.init.js"></script>
}